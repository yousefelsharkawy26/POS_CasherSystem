<Page
    x:Class="POS_ModernUI.Views.Pages.DashboardPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:POS_ModernUI.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:POS_ModernUI.ViewModels.Pages"
    xmlns:model="clr-namespace:POS_ModernUI.Models;assembly=POS_ModernUI.Models" xmlns:conv="clr-namespace:POS_ModernUI.Helpers"
    Title="DashboardPage"
    d:DataContext="{d:DesignInstance local:DashboardPage,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="650"
    d:DesignWidth="900"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d"
    FlowDirection="RightToLeft"
    MouseDown="Page_PreviewMouseDown">
    
    <Page.Resources>
        <conv:DbImageToPhysicalPathConverter x:Key="ImagePathConverter" />
        <conv:DecimalToMoneyConverter x:Key="DecimalToMoneyConverter"/>
        <conv:FractionConverter x:Key="FractionConverter"/>
        <conv:CusBooleanToVisibility x:Key="CusBooleanToVisibility"/>
    </Page.Resources>

    <Grid>
        <ContentPresenter Name="ContentPresenter"
                          Panel.ZIndex="10"/>
        
        <Grid VerticalAlignment="Top">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1.2*" />
            <ColumnDefinition Width="500" />
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <StackPanel Orientation="Horizontal">
                <ui:ToggleSwitch Grid.Row="0"
                                 Margin="10"
                                 Content="القطاعى"
                                 Cursor="Hand"
                                 IsChecked="{Binding ViewModel.IsWithoutBarCode, Mode=TwoWay}"
                                 Command="{Binding ViewModel.ToggleCheckedCommand}"
                                 HorizontalAlignment="Left"
                                 x:Name="toggleProducts"
                                 Click="Button_Click"/>

                <ui:TextBox x:Name="txtBarcode"
                            Opacity="0"
                            KeyDown="txtBarCode_KeyDown"/>
            </StackPanel>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                
                
                
                <ScrollViewer Grid.Row="1"
                              Grid.Column="3"
                              Height="{Binding ActualHeight, Converter={StaticResource FractionConverter}, ConverterParameter=0.9}"
                              FlowDirection="LeftToRight">
                    <ItemsControl ItemsSource="{Binding ViewModel.ProductList, Mode=OneWay}"
                                  Margin="10"
                                  Grid.Row="1"
                                  Grid.Column="1"
                                  FlowDirection="RightToLeft">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type model:Product}">
                                <ui:CardAction Padding="0"
                                               Width="140"
                                               VerticalAlignment="Stretch"
                                               CommandParameter="BasicInput"
                                               IsChevronVisible="False">
                                    <Button Command="{Binding Path=DataContext.ViewModel.AddProductCommand, RelativeSource= {RelativeSource FindAncestor,AncestorType={x:Type ItemsControl}}}"
                                            CommandParameter="{Binding}"
                                            Click="Button_Click">
                                        <Button.Resources>
                                            <Style TargetType="Button">
                                                <Setter Property="Cursor" Value="Hand"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                            <ControlTemplate>
                                                                <Border Margin="5 4 5 5"
                                                                        Height="100"
                                                                        CornerRadius="9">
                                                                    <Border.Background>
                                                                        <SolidColorBrush Color="Gray"
                                                                                         Opacity="0.08" />
                                                                    </Border.Background>
                                                                    <Grid>
                                                                        <Grid.RowDefinitions>
                                                                            <RowDefinition />
                                                                            <RowDefinition Height="auto" />
                                                                        </Grid.RowDefinitions>

                                                                        <ui:Image Grid.Row="0">
                                                                            <ui:Image.Source>
                                                                                <BitmapImage UriSource="{Binding Image, Mode=OneWay, Converter={StaticResource ImagePathConverter}}"/>
                                                                            </ui:Image.Source>
                                                                        </ui:Image>

                                                                        <ui:TextBlock HorizontalAlignment="Center"
                                                                                      VerticalAlignment="Bottom"
                                                                                      FontFamily="calibri"
                                                                                      Margin="0 0 0 15"
                                                                                      Text="{Binding Name}"
                                                                                      Grid.Row="1"/>
                                                                    
                                                                        <ui:TextBlock HorizontalAlignment="Center"
                                                                                      VerticalAlignment="Bottom"
                                                                                      FontFamily="calibri"
                                                                                      Margin="0 0 0 0"
                                                                                      Text="{Binding UnitShares[0].UnitPrice, Converter={StaticResource DecimalToMoneyConverter}}"
                                                                                      Grid.Row="1"/>
                                                                </Grid>
                                                                </Border>
                                                            </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Button.Resources>
                                    </Button>
                                </ui:CardAction>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                <!--#endregion-->
            </Grid>
        </Grid>
        
        <Grid Grid.Column="2" x:Name="grid_preview">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="auto" />
                <RowDefinition Height="auto" />
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid Grid.Column="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="105"/>
                </Grid.ColumnDefinitions>
                <Grid Width="300"
                      FlowDirection="RightToLeft">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Grid Margin="55 5" 
                          Grid.Row="0"
                          HorizontalAlignment="Center">
                        <ui:Button Icon="{ui:SymbolIcon Symbol=ArrowClockwise16}"
                                   Command="{Binding ViewModel.QuantityBackCommand}"
                                   Click="Button_Click"
                                   FontSize="20"
                                   Appearance="Transparent"
                                   BorderThickness="0"
                                   Cursor="Hand"
                                   Panel.ZIndex="10"/>

                        <ui:TextBox Width="200"
                                    Height="80"
                                    FontSize="40"
                                    ClearButtonEnabled="False"
                                    TextAlignment="Center"
                                    Text="{Binding ViewModel.Quantity}"
                                    IsReadOnly="True"/>

                        <ui:Button Icon="{ui:SymbolIcon Symbol=TextAsterisk16}"
                                   Command="{Binding ViewModel.ClearQuantityCommand}"
                                   CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                   FontSize="20"
                                   Background="Transparent"
                                   Foreground="IndianRed"
                                   Panel.ZIndex="10"
                                   BorderThickness="0"
                                   Cursor="Hand"
                                   HorizontalAlignment="Right"/>
                    </Grid>

                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Center"
                                    Grid.Row="0">
                        
                            <ui:Button Content="1"
                                       Background="#FF0C60E6"
                                       Opacity="0.7"
                                       Cursor="Hand"
                                       Foreground="White"
                                       Width="78"
                                       Height="45"
                                       Command="{Binding ViewModel.ChangeQuantityCommand}"
                                       CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                       Click="Button_Click"/>
                        
                            <ui:Button Content="2"
                                       Background="#FF0C60E6"
                                       Cursor="Hand"
                                       Opacity="0.7"
                                       Foreground="White"
                                       Width="78"
                                       Height="45"
                                       Command="{Binding ViewModel.ChangeQuantityCommand}"
                                       CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                       Click="Button_Click"/>
                        
                            <ui:Button Content="3"
                                        Background="#FF0C60E6"
                                        Opacity="0.7"
                                       Cursor="Hand"
                                        Foreground="White"
                                        Width="78"
                                        Height="45"
                                        Command="{Binding ViewModel.ChangeQuantityCommand}"
                                        CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                        Click="Button_Click"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Center"
                                    Grid.Row="1">

                            <ui:Button Content="4"
                                       Background="#FF0C60E6"
                                       Cursor="Hand"
                                       Opacity="0.7"
                                       Foreground="White"
                                       Width="78"
                                       Height="45"
                                       Command="{Binding ViewModel.ChangeQuantityCommand}"
                                       CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                       Click="Button_Click"/>

                            <ui:Button Content="5"
                                       Background="#FF0C60E6"
                                       Cursor="Hand"
                                       Opacity="0.7"
                                       Foreground="White"
                                       Width="78"
                                       Height="45"
                                       Click="Button_Click"
                                       Command="{Binding ViewModel.ChangeQuantityCommand}"
                                       CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"/>
                        
                            <ui:Button Content="6"
                                        Click="Button_Click"
                                        Background="#FF0C60E6"
                                        Cursor="Hand"
                                        Opacity="0.7"
                                        Foreground="White"
                                        Width="78"
                                        Height="45"
                                        Command="{Binding ViewModel.ChangeQuantityCommand}"
                                        CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"/>
                        
                        </StackPanel>

                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Center"
                                    Grid.Row="2">
                            <ui:Button Content="7"
                                        Click="Button_Click"
                                        Background="#FF0C60E6"
                                        Opacity="0.7"
                                        Cursor="Hand"
                                        Foreground="White"
                                        Width="78"
                                        Height="45"
                                        Command="{Binding ViewModel.ChangeQuantityCommand}"
                                        CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"/>

                            <ui:Button Content="8"
                                        Click="Button_Click"
                                        Background="#FF0C60E6"
                                        Opacity="0.7"
                                        Cursor="Hand"
                                        Foreground="White"
                                        Width="78"
                                        Height="45"
                                        Command="{Binding ViewModel.ChangeQuantityCommand}"
                                        CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"/>
                        
                            <ui:Button Content="9"
                                       Click="Button_Click"
                                       Background="#FF0C60E6"
                                       Cursor="Hand"
                                       Opacity="0.7"
                                       Foreground="White"
                                       Width="78"
                                       Height="45"
                                       Command="{Binding ViewModel.ChangeQuantityCommand}"
                                       CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"/>
                        </StackPanel>


                            <ui:Button Content="0"
                                       Grid.Row="3"
                                       Appearance="Dark"
                                       Width="234"
                                       Cursor="Hand"
                                       HorizontalAlignment="Center"
                                       Height="45"
                                       Command="{Binding ViewModel.ChangeQuantityCommand}"
                                       CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                       Click="Button_Click"/>


                    </Grid>
                </Grid>
                
                <WrapPanel Grid.Column="1"
                            Margin="0 10 0 0">
                    <ui:Button Content="جنيه"
                                Background="#FF0C60E6"
                                Opacity="0.7"
                               Cursor="Hand"
                                Foreground="White"
                                Width="100"
                                Height="45"
                                Command="{Binding ViewModel.SelectByPriceCommand}"
                                CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                Click="Button_Click"/>

                    <ui:Button Content="قطعة"
                                Background="#FF0C60E6"
                                Opacity="0.7"
                               Cursor="Hand"
                                Foreground="White"
                                Width="100"
                                Height="45"
                                Visibility="{Binding ViewModel.IsPieceEnabled, Converter={StaticResource CusBooleanToVisibility}}"
                                Command="{Binding ViewModel.SelectByPriceCommand}"
                                CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                Click="Button_Click"/>
                    
                    <ui:Button Content="علبة"
                                Background="#FF0C60E6"
                                Opacity="0.7"
                                Foreground="White"
                               Cursor="Hand"
                                Width="100"
                                Height="45"
                                Visibility="{Binding ViewModel.IsBoxEnabled, Converter={StaticResource CusBooleanToVisibility}}"
                                Command="{Binding ViewModel.SelectByBoxCommand}"
                                CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                Click="Button_Click"/>
                    
                    <ui:Button Content="كرتونة"
                                Background="#FF0C60E6"
                                Opacity="0.7"
                                Foreground="White"
                               Cursor="Hand"
                                Width="100"
                                Height="45"
                                Visibility="{Binding ViewModel.IsCartonEnabled, Converter={StaticResource CusBooleanToVisibility}}"
                                Command="{Binding ViewModel.SelectByCartonCommand}"
                                CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                Click="Button_Click"/>

                    <ui:Button Content="كيلو"
                                Background="#FF0C60E6"
                                Opacity="0.7"
                                Foreground="White"
                                Width="100"
                               Cursor="Hand"
                                Height="45"
                                Visibility="{Binding ViewModel.IsUnitsEnabled, Converter={StaticResource CusBooleanToVisibility}}"
                                Command="{Binding ViewModel.SelectByKiloCommand}"
                                CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                Click="Button_Click"/>

                    <ui:Button Content="جرام"
                                Background="#FF0C60E6"
                                Opacity="0.7"
                               Cursor="Hand"
                                Foreground="White"
                                Width="100"
                                Height="45"
                                Visibility="{Binding ViewModel.IsUnitsEnabled, Converter={StaticResource CusBooleanToVisibility}}"
                                Command="{Binding ViewModel.SelectByGramCommand}"
                                CommandParameter="{Binding Content, RelativeSource={RelativeSource Self}}"
                                Click="Button_Click"/>
                </WrapPanel>
            </Grid>
            
                    <!--DataGrid-->
            <DataGrid x:Name="Workersdata"
                      ItemsSource="{Binding ViewModel.ListOfSales, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      FontFamily="Calibri"
                      Grid.Row="1"
                      Height="200"
                      FontSize="15"
                      CanUserReorderColumns="False"
                      CanUserResizeColumns="False"
                      AutoGenerateColumns="False"
                      CanUserResizeRows="False"
                      VerticalScrollBarVisibility="Auto"
                      CanUserAddRows="False" 
                      CellEditEnding="Workersdata_CellEditEnding">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="المنتج"
                                        Binding="{Binding ProductName}"
                                        HeaderStyle="{DynamicResource CenterGridHeaderStyle}"
                                        IsReadOnly="True"
                                        ElementStyle="{StaticResource CenterDtaGridCell}"
                                        Width="*">
                        <DataGridTextColumn.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="ToolTip">
                                    <Setter.Value>
                                        <TextBlock FontSize='17' />
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="الكمية"
                                        Binding="{Binding Quantity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        ElementStyle="{StaticResource CenterDtaGridCell}"
                                        HeaderStyle="{DynamicResource CenterGridHeaderStyle}"
                                        IsReadOnly="False"
                                        Width=".75*">
                        <DataGridTextColumn.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="ToolTip">
                                    <Setter.Value>
                                        <TextBlock FontSize='17' />
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="الوحدة"
                                        Binding="{Binding UnitName}"
                                        ElementStyle="{StaticResource CenterDtaGridCell}"
                                        HeaderStyle="{DynamicResource CenterGridHeaderStyle}"
                                        IsReadOnly="True"
                                        Width="*">
                        <DataGridTextColumn.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="ToolTip">
                                    <Setter.Value>
                                        <TextBlock FontSize='17' />
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="سعر الوحدة"
                                        Binding="{Binding UnitPrice}"
                                        ElementStyle="{StaticResource CenterDtaGridCell}"
                                        HeaderStyle="{DynamicResource CenterGridHeaderStyle}"
                                        IsReadOnly="True"
                                        Width="*">
                        <DataGridTextColumn.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="ToolTip">
                                    <Setter.Value>
                                        <TextBlock FontSize='17' />
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="اجمالى السعر"
                                        Binding="{Binding TotalPrice}"
                                        ElementStyle="{StaticResource CenterDtaGridCell}"
                                        HeaderStyle="{DynamicResource CenterGridHeaderStyle}"
                                        IsReadOnly="True"
                                        Width="*">
                        <DataGridTextColumn.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="ToolTip">
                                    <Setter.Value>
                                        <TextBlock FontSize='17' />
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>


                    <DataGridTemplateColumn Header="عملیات"
                                            Width="85"
                                            HeaderStyle="{DynamicResource CenterGridHeaderStyle}">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal"
                                            HorizontalAlignment="Center">
                                    <Button Margin="4"
                                            Padding="7,5"
                                            CommandParameter="{Binding}"
                                            Command="{Binding Path=DataContext.ViewModel.RemoveProductCommand, RelativeSource= {RelativeSource FindAncestor,AncestorType={x:Type DataGrid}}}"
                                            Click="Button_Click">
                                        <ui:SymbolIcon Symbol="Delete16" />
                                        <Button.ToolTip>
                                            <TextBlock Text="حذف"
                                                        FontSize="14" />
                                        </Button.ToolTip>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <Grid Grid.Row="2"
                  Margin="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <ui:TextBlock Grid.Column="0"
                              FontSize="20"
                              Text="إجمالى المبلغ : " 
                              Appearance="Primary"
                              FontFamily="Cairo"
                              HorizontalAlignment="Center"/>

                <ui:TextBlock Text="{Binding ViewModel.TotalAmount, Mode=TwoWay, Converter={StaticResource DecimalToMoneyConverter}}"
                              Grid.Column="1"
                              Margin="0 0 0 10"
                              FontSize="20"
                              Foreground="Green"
                              FontWeight="ExtraBold"
                              FontFamily="Cairo"
                              HorizontalAlignment="Center"/>    
            </Grid>
            
            <StackPanel Grid.Row="3"
                        Orientation="Horizontal"
                        VerticalAlignment="Top">
                <ui:Button Content="تأكيد"
                           Background="#1F7D53"
                           Opacity="0.7"
                           Cursor="Hand"
                           Foreground="White"
                           Width="150"
                           Height="45"
                           Click="Button_Click_1"/>
                
                <ui:Button Content="فاتورة دين"
                           Background="#0ABAB5"
                           Opacity="0.7"
                           Cursor="Hand"
                           Foreground="White"
                           Height="45"
                           Width="150"
                           Click="Button_Click_2"/>

                <ui:Button Content="الغاء"
                           Cursor="Hand"
                           Background="#D84040"
                           Opacity="0.7"
                           Foreground="White"
                           Width="150"
                           Height="45"
                           Command="{Binding ViewModel.OrderCanceledCommand}"
                           Click="Button_Click"/>
            </StackPanel>
        </Grid>


        
    </Grid>
    </Grid>
</Page>
